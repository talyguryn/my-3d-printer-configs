# ============================================================
# CONFIG BUNDLE — Ender 3 + Klipper + PETG
# PrusaSlicer 2.9.4
# ============================================================

# ============================================================
# PRINTER PROFILE
# ============================================================
[printer:Ender3_Klipper_Moonraker]

printer_model = Ender 3
printer_technology = FFF
printer_variant = 0.4
nozzle_diameter = 0.4

printer_notes = Ender 3
; SKR Mini E3 V3.0
; Klipper firmware
; BMG Direct Drive

# BUILD VOLUME
bed_shape = 0x20,225x20,225x235,0x235
max_print_height = 210

# MACHINE LIMITS
machine_limits_usage = ignore

# GCODE & OUTPUT
gcode_flavor = klipper
use_relative_e_distances = 0
use_volumetric_e = 0

# --- Start/End GCODE ---
start_gcode = SET_PRINT_STATS_INFO TOTAL_LAYER=[total_layer_count]\nSTART_PRINT BED={first_layer_bed_temperature[0]} EXTRUDER={first_layer_temperature[0]}

start_filament_gcode = "SET_PRESSURE_TUNING K={if nozzle_diameter[0]==0.4}0.07{elsif nozzle_diameter[0]==0.25}0.12{elsif nozzle_diameter[0]==0.3}0.09{elsif nozzle_diameter[0]==0.35}0.08{elsif nozzle_diameter[0]==0.6}0.04{elsif nozzle_diameter[0]==0.5}0.05{elsif nozzle_diameter[0]==0.8}0.02{else}0{endif}\n\nSET_HEATBREAK_COOLING TEMP=36"

end_gcode = END_PRINT

# --- Layer GCODE ---
layer_gcode = SET_PRINT_STATS_INFO CURRENT_LAYER={layer_num + 1}
before_layer_gcode =
between_objects_gcode =
toolchange_gcode =

# --- Color Change & Pause ---
color_change_gcode = PAUSE
pause_print_gcode = PAUSE
colorprint_heights =

# --- Custom GCODE ---
template_custom_gcode =
post_process =

# --- Output Filename ---
output_filename_format = {input_filename_base}_0.4n_{layer_height}mm_{printing_filament_types}_{printer_model}_{print_time}.gcode

# PRINT HOST SETTINGS
host_type = octoprint
print_host = http://192.168.31.76
printhost_apikey =

# THUMBNAILS
thumbnails = 32x32/PNG, 300x300/PNG
thumbnails_format = PNG

# ============================================================
# FILAMENT — PETG BLACK
# ============================================================
[filament:PETG_Black]

filament_type = PETG
filament_vendor = Generic
filament_settings_id = PETG Black

filament_diameter = 1.75
filament_density = 1.33
filament_colour = #000000

temperature = 235
first_layer_temperature = 235

bed_temperature = 75
first_layer_bed_temperature = 77

fan_always_on = 0
disable_fan_first_layers = 3
max_fan_speed = 40

filament_max_volumetric_speed = 12


# ============================================================
# FILAMENT — PETG WHITE
# ============================================================
[filament:PETG_White]

filament_type = PETG
filament_vendor = Generic
filament_settings_id = PETG White

filament_colour = #FFFFFF

temperature = 230
first_layer_temperature = 235

bed_temperature = 75
first_layer_bed_temperature = 77

max_fan_speed = 40
filament_max_volumetric_speed = 10


# ============================================================
# FILAMENT — PETG ORANGE
# ============================================================
[filament:PETG_Orange]

filament_type = PETG
filament_vendor = Generic
filament_settings_id = PETG Orange

filament_colour = #FF8400

temperature = 235
first_layer_temperature = 240

bed_temperature = 75
first_layer_bed_temperature = 77

max_fan_speed = 40
filament_max_volumetric_speed = 12


# ============================================================
# PRINT PROFILE — PETG QUALITY
# ============================================================
[print:PETG_QUALITY]

layer_height = 0.2
first_layer_height = 0.28

perimeters = 3
external_perimeters_first = 0

perimeter_speed = 120
external_perimeter_speed = 80
infill_speed = 180
travel_speed = 300
first_layer_speed = 40

default_acceleration = 2000
external_perimeter_acceleration = 800
first_layer_acceleration = 800

retract_length = 1
retract_speed = 60
deretract_speed = 60
retract_lift = 0.2

cooling = 1
max_fan_speed = 40
bridge_fan_speed = 100

seam_position = aligned


# ============================================================
# PRINT PROFILE — UNIFIED
# ============================================================
[print:PETG]

# LAYER & HEIGHT SETTINGS
layer_height = 0.2
first_layer_height = 0.28

# PERIMETERS
perimeters = 2
external_perimeters_first = 0

# SPEEDS
# --- General Speeds ---
first_layer_speed = 35
max_print_speed = 250
min_print_speed = 15
travel_speed = 250
travel_speed_z = 0
deretract_speed = 30
retract_speed = 30

# --- Perimeter Speeds ---
perimeter_speed = 200
external_perimeter_speed = 140
small_perimeter_speed = 60

# --- Infill & Fill Speeds ---
infill_speed = 180
solid_infill_speed = 140
gap_fill_speed = 60

# --- Special Feature Speeds ---
bridge_speed = 60
top_solid_infill_speed = 100
support_material_speed = 120
support_material_interface_speed = 100

# --- Overhang Speeds (progressive) ---
overhang_speed_0 = 20
overhang_speed_1 = 25
overhang_speed_2 = 30
overhang_speed_3 = 35

# ACCELERATIONS
default_acceleration = 3000
first_layer_acceleration = 1000
infill_acceleration = 2000
perimeter_acceleration = 1500
external_perimeter_acceleration = 1000
top_solid_infill_acceleration = 1500
solid_infill_acceleration = 1500
travel_acceleration = 2000
bridge_acceleration = 1000

# RETRACTIONS
retract_length = 1
retract_lift = 0.2

cooling = 1
max_fan_speed = 40
bridge_fan_speed = 100

seam_position = aligned

# SOLID INFILL
bottom_solid_layers = 3
bottom_solid_min_thickness = 0.8
top_solid_layers = 3
top_solid_min_thickness = 0.8
bottom_fill_pattern = monotonic
top_fill_pattern = monotonic

# INFILL
fill_density = 5%
fill_pattern = adaptivecubic

# SKIRT & BRIM
skirts = 0

# SUPPORTS
support_material_style = organic
